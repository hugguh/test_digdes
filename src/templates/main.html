<!DOCTYPE HTML>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="icon" href="/static/img/favicon.ico">
    <title>Digdes test lesson</title>

    <meta name="description" content="photo"/>
    <meta name="keywords" content="instagram, photo"/>

</head>
<body class="pb-0">
<header>
    <div class="collapse bg-dark" id="navbarHeader">
        <div class="container">
            <div class="row">
                <div class="col-sm-8 col-md-7 py-4">
                    <h4 class="text-white">About</h4>
                    <p class="text-muted">This is example of my skills doing sites with using knowledge of JS, HTML5,
                        CSS, Bootstrap 4, Python and Docker.</p>
                </div>
                <div class="col-sm-4 offset-md-1 py-4">
                    <h4 class="text-white">Contact</h4>
                    <ul class="list-unstyled">
                        <li><a href="https://twitter.com/double_spend" class="text-white" target="_blank">Follow on
                            Twitter</a></li>
                        <li><a href="https://www.facebook.com" class="text-white" target="_blank">Like on Facebook</a>
                        </li>
                        <li><a href="https://www.instagram.com/hugguh1234/" class="text-white" target="_blank">Like on
                            Instagram</a></li>
                        <li><a href="mailto:ivanmyasnikov@icloud.com" class="text-white">Email me</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="navbar navbar-dark bg-dark shadow-sm">
        <div class="container d-flex justify-content-between">
            <a href="#" class="navbar-brand d-flex align-items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor"
                     stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true" class="mr-2"
                     viewBox="0 0 24 24">
                    <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                    <circle cx="12" cy="13" r="4"/>
                </svg>
                <strong class="name">Album</strong>
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarHeader"
                    aria-controls="navbarHeader" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </div>
</header>

<main>

    <section class="py-5 text-center container about_user">

    </section>

    <div class="album py-5 bg-light">
        <div class="container">

            <div class="row justify-content-center user_posts"></div>
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <button id="get_inst_photo" type="button" class="btn btn-outline-secondary">Больше постов</button>
                </div>
            </div>

        </div>
    </div>

</main>

<footer class="text-muted py-5">
    <div class="container">
        <p class="float-right mb-1">
            <a href="#">Back to top</a>
        </p>
        <p class="mb-1">Album example Instagram user <a href="https://www.instagram.com/hugguh1234/">Hugguh1234</a></p>
    </div>
</footer>


<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
<script src="/static/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        let token = '20661315763.de65ec3.be41e77ad7f3401985c6b920f1fee592',
            count = 5,
            max_id;

        function formate_date(post_time_timstmp) {

            let post_time_date = new Date(post_time_timstmp * 1000);
            let dd = post_time_date.getDate();
            if (dd < 10) dd = '0' + dd;
            let mm = post_time_date.getMonth() + 1;
            if (mm < 10) mm = '0' + mm;
            let yy = post_time_date.getFullYear();
            let post_time = dd + '.' + mm + '.' + yy;
            return post_time;

        }

        $.ajax({
            url: 'https://api.instagram.com/v1/users/self',
            dataType: 'json',
            type: 'GET',
            data: {access_token: token},
            success: function (result) {
                let fullname = result.data.full_name;
                let apper_fullname = fullname.split(/\s+/).map(word => word[0].toUpperCase() + word.substring(1)).join(' ');
                $('.about_user').append('<div class="row">\n' +
                    '            <div class="col-lg-6 col-md-8 mx-auto">\n' +
                    '                <h3 class="font-weight-light"><a>' + apper_fullname + '</a></h3>\n' +
                    '                <div class=""><img style="border-radius: 50%; width: 13em" src="' + result.data.profile_picture + '" alt="' + apper_fullname + '"></div>\n' +
                    '                <small class="lead text-muted"><a>Публикаций ' + result.data.counts.media + '</a></small>\n' +
                    '            </div>\n' +
                    '        </div>');
            },
            error: function (result) {
                console.log(result);
            }
        });

        $.ajax({
            url: 'https://api.instagram.com/v1/users/self/media/recent',
            dataType: 'json',
            type: 'GET',
            data: {access_token: token, count: count},
            success: function (result) {
                let len_data = result.data.length;
                max_id = result.data[len_data - 1].id;
                for (x in result.data) {
                    let post_time_timstmp = parseInt(result.data[x].created_time);
                    let post_time = formate_date(post_time_timstmp);
                    $('.user_posts').append('<div class="col-md-8">\n' +
                        '                    <div class="card mb-4 shadow-sm">\n' +
                        '                        <div class="mx-auto"><img class="pt-4" style="border-radius: 0.25rem" src="' + result.data[x].images.standard_resolution.url + '" alt="' + result.data[x].caption.text + '"></div>\n' +
                        '                        <div class="card-body">\n' +
                        '                            <p class="card-text pl-5"><a>' + result.data[x].caption.text + '</a></p>\n' +
                        '                            <div class="d-flex pl-5">\n' +
                        '                                <small class="col-2 text-muted"><i class="mr-2 fa fa-heart"></i>' +
                        '                                   <a>' + result.data[x].likes.count + '</a></small>\n' +
                        '                                <small class="col-2 text-muted"><i class="mr-2 fa fa-comment"></i>' +
                        '                                   <a>' + result.data[x].comments.count + '</a></small>\n' +
                        '                                <small class="col-4 text-muted"><i class="mr-2 fa fa-calendar"></i>' +
                        '                                   <a>' + post_time + '</a></small>\n' +
                        '                            </div>\n' +
                        '                        </div>\n' +
                        '                    </div>\n' +
                        '                </div>');
                }
                if (len_data < 5) {
                    $('#get_inst_photo').hide();
                }
            },
            error: function (result) {
                console.log(result);
            }
        });

        $(document).on("click", '#get_inst_photo', get_inst_photo);

        function get_inst_photo() {
            let count = 5;

            $.ajax({
                url: 'https://api.instagram.com/v1/users/self/media/recent',
                dataType: 'json',
                type: 'GET',
                data: {access_token: token, count: count, max_id: max_id},
                success: function (result) {
                    let len_data = result.data.length;
                    if (len_data > 0) {
                        max_id = result.data[len_data - 1].id;
                    }
                    for (x in result.data) {
                        let post_time_timstmp = parseInt(result.data[x].created_time);
                        let post_time = formate_date(post_time_timstmp);
                        $('.user_posts').append('<div class="col-md-8">\n' +
                            '                    <div class="card mb-4 shadow-sm">\n' +
                            '                        <div class="mx-auto"><img class="pt-4" style="border-radius: 0.25rem" src="' + result.data[x].images.standard_resolution.url + '" alt="' + result.data[x].caption.text + '"></div>\n' +
                            '                        <div class="card-body">\n' +
                            '                            <p class="card-text pl-5"><a>' + result.data[x].caption.text + '</a></p>\n' +
                            '                            <div class="d-flex pl-5">\n' +
                            '                                <small class="col-2 text-muted"><i class="mr-2 fa fa-heart"></i>' +
                            '                                   <a>' + result.data[x].likes.count + '</a></small>\n' +
                            '                                <small class="col-2 text-muted"><i class="mr-2 fa fa-comment"></i>' +
                            '                                   <a>' + result.data[x].comments.count + '</a></small>\n' +
                            '                                <small class="col-4 text-muted"><i class="mr-2 fa fa-calendar"></i>' +
                            '                                   <a>' + post_time + '</a></small>\n' +
                            '                            </div>\n' +
                            '                        </div>\n' +
                            '                    </div>\n' +
                            '                </div>');

                    }
                    if (len_data < 5) {
                        $('#get_inst_photo').hide();
                    }
                },
                error: function (result) {
                    console.log(result);
                }
            });
        }

    });
</script>
</body>

</html>